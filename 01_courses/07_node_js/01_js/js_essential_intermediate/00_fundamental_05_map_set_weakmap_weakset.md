# Map, Set, WeakMap, WeakSet

> ğŸ“š **ì‚¬ì „ ì§€ì‹**: ì´ ë¬¸ì„œëŠ” JavaScriptì˜ ê¸°ë³¸ ê°ì²´ì™€ ë°°ì—´ì„ ì´í•´í•œ ê°œë°œìë¥¼ ëŒ€ìƒìœ¼ë¡œ í•©ë‹ˆë‹¤.  
> ê°ì²´ ì†ì„± ì ‘ê·¼, ë°°ì—´ ë©”ì„œë“œ, ì´í„°ëŸ¬ë¸” ê°œë…ì„ ì•Œê³  ìˆë‹¤ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.

---

## 1. ì™œ ì“¸ê¹Œ â€” "ì˜ë„ë¥¼ ë“œëŸ¬ë‚´ëŠ” ì „ìš© ì»¬ë ‰ì…˜"

- `Object`/`Array`ë¡œë„ ëŒ€ë¶€ë¶„ êµ¬í˜„ ê°€ëŠ¥í•˜ì§€ë§Œ, **ìš©ë„Â·ì„±ëŠ¥Â·ê°€ë…ì„±** ì¸¡ë©´ì—ì„œ ì „ìš© ì»¬ë ‰ì…˜ì´ ë” ë‚«ë‹¤.
    
- **Map = í‚¤/ê°’ ì‚¬ì „**, **Set = ì¤‘ë³µ ì—†ëŠ” ì§‘í•©**.  
    â†’ ì½”ë“œ ì½ëŠ” ì‚¬ëŒì—ê²Œ â€œì´ê±´ ì‚¬ì „ì´ë‹¤â€, â€œì´ê±´ ì§‘í•©ì´ë‹¤â€ë¥¼ ì¦‰ì‹œ ì „ë‹¬.
    
- **WeakMap/WeakSet = ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì„ ë°©í•´í•˜ì§€ ì•ŠëŠ”(ì•½í•œ ì°¸ì¡°) ì»¬ë ‰ì…˜**.
    

---

## 2. Map â€” í‚¤/ê°’ ì‚¬ì „ (í‚¤ íƒ€ì… ì œí•œ ì—†ìŒ)

### í•µì‹¬ íŠ¹ì§•

- í‚¤ íƒ€ì…: **ì›ì‹œ/ê°ì²´/í•¨ìˆ˜ ë¬´ì—‡ì´ë“  ê°€ëŠ¥**. (ObjectëŠ” `string/symbol`ë§Œ)
    
- í¬ê¸°: `.size` (ë°°ì—´ì˜ `.length`ì™€ ìœ ì‚¬)
    
- ë°˜ë³µ: ìˆœíšŒê°€ **ë„£ì€ ìˆœì„œ**ë¥¼ ìœ ì§€.
    

### ê¸°ë³¸ ì‚¬ìš©

```js
const m = new Map();

m.set('a', 1).set('b', 2);      // ì²´ì´ë‹ ê°€ëŠ¥
m.get('a');                      // 1
m.has('b');                      // true
m.delete('a');                   // true
m.size;                          // 1
m.clear();                       // ë¹„ìš°ê¸°
```

### ê°ì²´ë¥¼ í‚¤ë¡œ ì“¸ ë•Œ ì£¼ì˜(ì°¸ì¡° ë™ì¼ì„±)

```js
const obj = { id: 1 };
const m = new Map();
m.set(obj, { role: 'admin' });

m.get({ id: 1 });   // undefined (ë‹¤ë¥¸ ì°¸ì¡°)
m.get(obj);         // { role: 'admin' }  âœ…
```

â†’ **ë™ì¼í•œ ê°ì²´ ì°¸ì¡°**ë¥¼ ì¨ì•¼ í•œë‹¤. ì„ì‹œ ë¦¬í„°ëŸ´ë¡œ ì¬ì‘ì„±í•˜ë©´ ëª» ì°¾ëŠ”ë‹¤.

### ë°˜ë³µ íŒ¨í„´

```js
for (const [k, v] of m) { /* ... */ }     // ê¸°ë³¸ ì´í„°ë ˆì´í„°ê°€ [k,v]
m.forEach((v, k) => { /* ... */ });       // forEachë„ ì§€ì›
[...m.keys()], [...m.values()], [...m.entries()];
```

---

## 3. Set â€” ì¤‘ë³µ ì—†ëŠ” ì§‘í•©

### í•µì‹¬ íŠ¹ì§•

- ê°’ íƒ€ì…: ë¬´ì—‡ì´ë“  ê°€ëŠ¥(ë™ì¼ì„± ë¹„êµëŠ” `SameValueZero`, `NaN`ë„ ìì‹ ê³¼ ê°™ë‹¤).
    
- **ì¤‘ë³µ ìë™ ì œê±°**, ì‚½ì… ìˆœì„œ ìœ ì§€, `.size` ë³´ìœ .
    

### ê¸°ë³¸ ì‚¬ìš©

```js
const s = new Set([1,2,2,3]);
s.has(2);         // true
s.add(3).add(4);  // {1,2,3,4}
s.delete(1);      // true
s.size;           // 3
for (const v of s) { /* ... */ }
s.clear();
```

### ë°°ì—´ ì¤‘ë³µ ì œê±° ì¹˜íŠ¸í‚¤

```js
const arr = [1,2,3,2,3,5,2];
const deduped = [...new Set(arr)];     // [1,2,3,5]
```

- ë©´ì ‘ ë‹¨ê³¨. â€œì„¸íŠ¸ë¡œ ì¤‘ë³µ ì œê±° â†’ ë‹¤ì‹œ ë°°ì—´ë¡œâ€.
    

---

## 4. WeakMap / WeakSet â€” ì•½í•œ ì°¸ì¡°(ìë™ ë©”ëª¨ë¦¬ í•´ì œ)

> ğŸ”¥ **ê³ ê¸‰ ì£¼ì œ**: WeakMap/WeakSetì€ ë©”ëª¨ë¦¬ ê´€ë¦¬ì™€ ê´€ë ¨ëœ ê³ ê¸‰ ê°œë…ì…ë‹ˆë‹¤.  
> ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ, íŠ¹ì • ìƒí™©ì—ì„œ ìœ ìš©í•©ë‹ˆë‹¤. ê¸°ë³¸ Map/Setì„ ë¨¼ì € ìµíˆëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

### ê³µí†µ ê°œë…

- **í‚¤(WeakMap)** / **ìš”ì†Œ(WeakSet)** ê°€ **ê°ì²´ì¼ ë•Œë§Œ** í—ˆìš©. (ì›ì‹œëŠ” ë¶ˆê°€)
    
- **ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì´ ê°€ëŠ¥**: ì™¸ë¶€ì—ì„œ ê°ì²´ë¥¼ ë” ì´ìƒ ì°¸ì¡°í•˜ì§€ ì•Šìœ¼ë©´ ì»¬ë ‰ì…˜ í•­ëª©ë„ **ìë™ ì œê±°**.
    
- **ì—´ê±° ë¶ˆê°€**: `size`, `keys()`, ë°˜ë³µë¬¸ ë¯¸ì§€ì› â†’ ë©”ëª¨ë¦¬ ê´€ë¦¬ ëª©ì ì´ë¼ ìˆœíšŒê°€ ì˜ë¯¸ ì—†ìŒ.
    

### WeakMap â€” ê°ì²´ â†’ ë¶€ê°€ì •ë³´ (ì›ë³¸ ê°ì²´ëŠ” ë¶ˆë³€ ìœ ì§€)

```js
const meta = new WeakMap();

function tagUser(user) {
  meta.set(user, { married: false });
}

let user = { name: 'ZeroCho' };
tagUser(user);
meta.get(user);          // { married: false }

user = null;             // ì™¸ë¶€ ì°¸ì¡° í•´ì œ â†’ GC ì‹œ ë©”íƒ€ë„ í•¨ê»˜ ì •ë¦¬
```

- **ì›ë³¸ ê°ì²´ë¥¼ ì˜¤ì—¼ì‹œí‚¤ì§€ ì•Šê³ ** ë©”íƒ€ë°ì´í„°ë¥¼ ë¶™ì´ê³  ì‹¶ì„ ë•Œ ìµœì .
    

### WeakSet â€” â€œê°ì²´ê°€ ì§‘í•©ì— ì†í•´ ìˆëŠ”ê°€â€ ì •ë„ë§Œ í•„ìš”í•  ë•Œ

```js
const visited = new WeakSet();
let node = { id: 1 };
visited.add(node);
visited.has(node);   // true
node = null;         // ì™¸ë¶€ ì°¸ì¡° ì‚¬ë¼ì§€ë©´ ìë™ ì •ë¦¬
```

- ì‹¤ì „ì—ì„œ ì“°ì„ìƒˆê°€ ì œí•œì ì´ì§€ë§Œ, **ìˆœíšŒ ì—†ì´ â€œí‘œì‹(visited)ë§Œ ë¶™ì´ê¸°â€** ìš©ë„ë¡œ ê°„í˜¹ ì‚¬ìš©.
    

---

## 5. ìì£¼ í‹€ë¦¬ëŠ” í¬ì¸íŠ¸ & íŒ

1. **Mapì—ì„œ `.length` ì°¾ê¸°**  
    â†’ `m.length`ê°€ ì•„ë‹ˆë¼ **`m.size`**.
    
2. **ê°ì²´ í‚¤ ì¬ìƒì„±**  
    â†’ `m.get({ id: 1 })`ëŠ” ì‹¤íŒ¨. **ê°™ì€ ì°¸ì¡°**ë¥¼ ì¨ë¼.
    
3. **Object vs Map ì„±ëŠ¥**
    
    - ë‹¤ìˆ˜ì˜ ì‚½ì…/ì‚­ì œ/íƒìƒ‰ì´ ë°˜ë³µë˜ê³  **í‚¤ íƒ€ì…ì´ ë‹¤ì–‘**í•˜ë©´ Mapì´ ìœ ë¦¬.
        
    - â€œë”±íˆ ì—°ì‚°ì´ ë§ì§€ ì•Šê³  ì§ë ¬í™”(JSON)í•´ì•¼ í•œë‹¤â€ â†’ í‰ë²”í•œ Objectê°€ í¸í•˜ë‹¤.
        
4. **Setê³¼ ê¹Šì€ ë™ë“±ì„±**
    
    - `Set`ì˜ ë™ì¼ì„±ì€ ì°¸ì¡°/ì›ì‹œ ê°’ ê¸°ì¤€. ê°ì²´ êµ¬ì¡°ê°€ ê°™ì•„ë„ **ë‹¤ë¥¸ ì°¸ì¡°ë©´ ë‹¤ë¥¸ ìš”ì†Œ**.
        
5. **Weak ê³„ì—´ì˜ í•œê³„**
    
    - **ìˆœíšŒ/í¬ê¸° í™•ì¸ ë¶ˆê°€**. â€œë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€â€ ëª©ì ì¼ ë•Œë§Œ ì±„íƒ.
        
6. **ì •ë ¬ í•„ìš”?**
    
    - Map/Setì€ ì‚½ì… ìˆœì„œë¥¼ ê¸°ì–µí•˜ì§€ë§Œ **ì •ë ¬ ì»¬ë ‰ì…˜ì€ ì•„ë‹ˆë‹¤**. ì •ë ¬ì´ í•„ìš”í•˜ë©´ í¼ì³ì„œ ë°°ì—´ë¡œ ë³€í™˜ í›„ ì •ë ¬:
        
        ```js
        const sorted = [...m.entries()].sort((a,b) => a[0]-b[0]);
        ```
        

---

## 6. Node.js ì‹¤ì „ í™œìš© íŒ¨í„´

### (1) ìš”ì²­ ë‹¨ìœ„ ìºì‹œ(ë©”ëª¨ì´ì œì´ì…˜)

```js
const cache = new Map(); // í‚¤: ë¬¸ìì—´/ê°ì²´/íŠœí”Œ ë“± ììœ 

export async function getUser(id) {
  if (cache.has(id)) return cache.get(id);
  const user = await repo.findById(id);
  cache.set(id, user);
  return user;
}
```

### (2) ê°ì²´ì— ë©”íƒ€ ë¶™ì´ê¸°(ì›ë³¸ ë¶ˆë³€) â€” WeakMap

```js
const meta = new WeakMap();

function attach(ctx, data) { meta.set(ctx, data); }
function info(ctx) { return meta.get(ctx); }

// ì˜ˆ) Express ë¯¸ë“¤ì›¨ì–´ ì»¨í…ìŠ¤íŠ¸/ì†Œì¼“ í´ë¼ì´ì–¸íŠ¸ ì†Œì¼“ ê°ì²´ì— ë¶€ê°€ì •ë³´ ë¶€ì°©
```

### (3) ì¤‘ë³µ ì‘ì—… ë°©ì§€ â€” Set

```js
const inFlight = new Set();

async function runOnce(key, job) {
  if (inFlight.has(key)) return;    // ì´ë¯¸ ì§„í–‰ ì¤‘
  inFlight.add(key);
  try { await job(); }
  finally { inFlight.delete(key); }
}
```

### (4) ìˆœí™˜ ì°¸ì¡° íƒì§€ â€” WeakSet

```js
function toJSONSafe(obj, seen = new WeakSet()) {
  if (obj && typeof obj === 'object') {
    if (seen.has(obj)) return '[Circular]';
    seen.add(obj);
    // ... ì¬ê·€ ì§ë ¬í™”
  }
  return obj;
}
```

### (5) ì„¸ì…˜/ì—°ê²° ê´€ë¦¬

- **Map**: `clientId â†’ socket`, `jobId â†’ AbortController` ë“± í‚¤/ê°’ ë§¤í•‘.
    
- **Set**: í˜„ì¬ í™œì„± í´ë¼ì´ì–¸íŠ¸ ëª©ë¡, êµ¬ë… ì±„ë„ ì°¸ì—¬ì ì§‘í•©.
    
- **WeakMap**: ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°ì²´ì— ìƒíƒœ ë¶€ì°©(ì›ë³¸ íƒ€ì…ì„ ì¹¨ë²”í•˜ì§€ ì•ŠìŒ).
    

---

## 7. ë©”ì„œë“œ ë ˆí¼ëŸ°ìŠ¤(ì•”ê¸° í‘œ)

|ì»¬ë ‰ì…˜|ì¶”ê°€|ì½ê¸°|ì¡´ì¬|ì‚­ì œ|ë¹„ìš°ê¸°|í¬ê¸°|ë°˜ë³µ|
|---|---|---|---|---|---|---|---|
|**Map**|`set(k,v)`|`get(k)`|`has(k)`|`delete(k)`|`clear()`|`.size`|`for..of`, `forEach`, `keys/values/entries`|
|**Set**|`add(v)`|_(ì—†ìŒ)_|`has(v)`|`delete(v)`|`clear()`|`.size`|`for..of`, `forEach`, `values()`(=entries)|
|**WeakMap**|`set(obj,v)`|`get(obj)`|`has(obj)`|`delete(obj)`|_(ì—†ìŒ)_|_(ì—†ìŒ)_|_(ë¶ˆê°€)_|
|**WeakSet**|`add(obj)`|_(ì—†ìŒ)_|`has(obj)`|`delete(obj)`|_(ì—†ìŒ)_|_(ì—†ìŒ)_|_(ë¶ˆê°€)_|

---

## 8. ì—°ìŠµ ê³¼ì œ

1. **LRU ìŠ¤íƒ€ì¼ ìºì‹œ ìŠ¤ì¼€ì¹˜ (Map í™œìš©)**
    
    - ê³ ì • ìš©ëŸ‰ `capacity`ë¥¼ ê°€ì§„ `LruCache` í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë¼.
        
    - `get(k)`ê°€ í˜¸ì¶œë˜ë©´ í•­ëª©ì„ ìµœì‹ ìœ¼ë¡œ ê°±ì‹ , `set(k,v)`ì—ì„œ ë„˜ì¹˜ë©´ **ê°€ì¥ ì˜¤ë˜ëœ** í•­ëª© ì œê±°.
        
    - íŒíŠ¸: Mapì€ ì‚½ì… ìˆœì„œë¥¼ ê¸°ì–µí•œë‹¤. ì¬ì‚½ì…ìœ¼ë¡œ ìµœì‹ í™” ê°€ëŠ¥.
        
2. **ë°°ì—´ ì¤‘ë³µ ì œê±°/êµì§‘í•©/í•©ì§‘í•©(Set í™œìš©)**
    
    - `uniq(arr)`, `intersect(a,b)`, `union(a,b)` ì‘ì„±.
        
3. **ë©”íƒ€ë°ì´í„° ë¶€ì°©(WeakMap)**
    
    - ì™¸ë¶€ì—ì„œ ë°›ì€ ë¶ˆë³€ ê°ì²´ `user`ì— ëŒ€í•´, ë¡œì»¬ ê¶Œí•œ/í”Œë˜ê·¸ë¥¼ WeakMapìœ¼ë¡œ ë¶€ì°©í•˜ê³ ,  
        ì™¸ë¶€ ì°¸ì¡°ë¥¼ ëŠì—ˆì„ ë•Œ ë©”íƒ€ë„ ìë™ í•´ì œë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì½”ë“œë¡œ ì‹œë®¬ë ˆì´ì…˜.
        
4. **ìˆœí™˜ ì§ë ¬í™” ë°©ì§€(WeakSet)**
    
    - ìˆœí™˜ êµ¬ì¡°ê°€ ìˆëŠ” ê°ì²´ë¥¼ ì•ˆì „í•˜ê²Œ ë¬¸ìì—´í™”í•˜ëŠ” `safeStringify` ì‘ì„±(ì¤‘ë³µ ê°ì²´ëŠ” `"[Circular]"`ë¡œ ì¹˜í™˜).
        

---

## 9. ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì§€ì‹ í™•ì¸

- [ ] Mapì—ì„œ **ê°ì²´ í‚¤**ëŠ” **ë™ì¼ ì°¸ì¡°**ì¼ ë•Œë§Œ ì¼ì¹˜í•œë‹¤.
    
- [ ] Map/Setì€ í¬ê¸°ë¥¼ `.size`ë¡œ í™•ì¸í•œë‹¤.
    
- [ ] Setì€ **ì¤‘ë³µì„ ìë™ ì œê±°**í•˜ë©°, ë°°ì—´ â†” Set ë³€í™˜ì„ ìœ ì—°í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.
    
- [ ] WeakMap/WeakSetì€ **ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì„ ë°©í•´í•˜ì§€ ì•ŠëŠ”ë‹¤**(ìˆœíšŒÂ·size ì—†ìŒ).
    
- [ ] "ì›ë³¸ ê°ì²´ë¥¼ ì˜¤ì—¼ì‹œí‚¤ì§€ ì•Šê³  ë©”íƒ€ë¥¼ ë¶™ì¸ë‹¤" â†’ **WeakMap**ì„ ë– ì˜¬ë¦°ë‹¤.
    
- [ ] "ì¤‘ë³µ ì—†ëŠ” ì»¬ë ‰ì…˜" ë˜ëŠ” "ì¤‘ë³µ ì œê±°" â†’ **Set**ë¶€í„° ì ìš©í•œë‹¤.
    
- [ ] "í‚¤/ê°’ ë§¤í•‘ì´ ë§ê³  íƒ€ì…ì´ ë‹¤ì–‘" â†’ **Map**ì´ `Object`ë³´ë‹¤ ì„ í˜¸ëœë‹¤.

### ì‹¤ì „ ëŠ¥ë ¥

- [ ] ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ Map/Setì„ ì ì ˆíˆ í™œìš©í•œë‹¤.
    
- [ ] ì½”ë“œ ë¦¬ë·°ì—ì„œ ì»¬ë ‰ì…˜ íƒ€ì… ì„ íƒì˜ ì ì ˆì„±ì„ íŒë‹¨í•  ìˆ˜ ìˆë‹¤.
    
- [ ] ë©´ì ‘ì—ì„œ Map/Setê³¼ Object/Arrayì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤.

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [MDN: Map](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Map)
- [MDN: Set](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Set)
- [MDN: WeakMap](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)

---

## ë‹¤ìŒ ë‹¨ê³„

ì´ ê°œë…ì„ ì´í•´í–ˆë‹¤ë©´ ë‹¤ìŒ ì£¼ì œë¡œ ë„˜ì–´ê°€ì„¸ìš”:
- **06. ë„ ë³‘í•© & ì˜µì…”ë„ ì²´ì´ë‹** - ì•ˆì „í•œ ê°’ ì ‘ê·¼
- **04. í´ë˜ìŠ¤ & Promise & async/await** - ê°ì²´ ì§€í–¥ê³¼ ë¹„ë™ê¸° (ì´ì „ ì£¼ì œ)